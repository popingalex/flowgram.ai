---
description:
globs:
alwaysApply: false
---
# å®ä½“å±æ€§ç¼–è¾‘å™¨è®¾è®¡æ–‡æ¡£

## ğŸ¯ æ ¸å¿ƒé—®é¢˜è§£å†³æ–¹æ¡ˆ

### é—®é¢˜èƒŒæ™¯
- Reactç»„ä»¶ä¸­ä½¿ç”¨å¯å˜å±æ€§ä½œä¸ºkeyå¯¼è‡´inputå¤±å»ç„¦ç‚¹
- ç”¨æˆ·ä¿®æ”¹å±æ€§åæ—¶ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œç¼–è¾‘çŠ¶æ€ä¸¢å¤±
- æ•°æ®ç»“æ„è¿‡äºå¤æ‚ï¼Œç»´æŠ¤å›°éš¾

### è§£å†³æ–¹æ¡ˆï¼šnanoidç´¢å¼•è®¾è®¡æ¨¡å¼

## ğŸ“Š æ•°æ®ç»“æ„è®¾è®¡

### 1. Storeæ•°æ®ç»“æ„ (åå°äº¤äº’)
```javascript
// å­˜å‚¨åœ¨ [entity-store](mdc:apps/demo-free-layout-forked/src/components/ext/entity-store/index.tsx) ä¸­
{
  id: "helicopter",
  name: "ç›´å‡æœº",
  bundles: ["container", "mobile", "controlled"], // å®Œæ•´å…³è”çš„æ¨¡å—
  attributes: [
    { id: "vehicle_yard_id", name: "é›†ç»“ç‚¹id", type: "s", enumClassId: "yard_enum" },
    { id: "task_id", name: "ä»»åŠ¡id", type: "s" }
  ]
}
```

### 2. JSONSchemaæ•°æ®ç»“æ„ (èŠ‚ç‚¹ç¼–è¾‘å™¨)
```javascript
// åœ¨ [entity-properties-editor](mdc:apps/demo-free-layout-forked/src/components/ext/entity-properties-editor/index.tsx) ä¸­å¤„ç†
{
  type: "object",
  properties: {
    "abc123": {                    // nanoidä½œä¸ºkey - React keyä¸“ç”¨
      id: "vehicle_yard_id",       // åŸå§‹è‹±æ–‡æ ‡è¯†ç¬¦
      name: "é›†ç»“ç‚¹id",            // åŸå§‹ä¸­æ–‡åç§°
      type: "string",              // è½¬æ¢åçš„JSONSchemaç±»å‹
      description: "...",          // æè¿°ä¿¡æ¯
      enumClassId: "yard_enum",    // ä¿ç•™çš„metaå±æ€§
      _id: "abc123",               // ç´¢å¼•ID - ä¸keyç›¸åŒ
      isEntityProperty: true       // å±æ€§åˆ†ç±»æ ‡è®°
    },
    "def456": {                    // nanoidä½œä¸ºkey
      id: "mobile/path",           // æ¨¡å—å±æ€§IDæ ¼å¼
      name: "è·¯å¾„",                // åŸå§‹ä¸­æ–‡åç§°
      type: "array",
      items: { type: "string" },
      description: "æ¥è‡ªæ¨¡å—: ç§»åŠ¨çš„",
      _id: "def456",               // ç´¢å¼•ID
      isModuleProperty: true,      // æ¨¡å—å±æ€§æ ‡è®°
      moduleId: "mobile"           // æ‰€å±æ¨¡å—ID
    }
  }
}
```

## ğŸ”‘ nanoidç´¢å¼•è®¾è®¡æ ¸å¿ƒ

### ç´¢å¼•ID (nanoid)
- **ç”¨é€”**: React keyä¸“ç”¨ï¼Œç¡®ä¿ç»„ä»¶ç¨³å®šæ€§
- **ç‰¹ç‚¹**: æ°¸è¿œä¸å˜ï¼Œä½¿ç”¨nanoidç”Ÿæˆ
- **ç”Ÿæˆ**: `nanoid()` - çŸ­å°ç²¾æ‚çš„å”¯ä¸€æ ‡è¯†ç¬¦
- **ä½¿ç”¨**: ä½œä¸ºpropertiesçš„keyå’Œ_idå­—æ®µ

### Metaå±æ€§ä¿ç•™
- **åŸåˆ™**: ä½¿ç”¨`...attr`ä¿ç•™æ‰€æœ‰åŸå§‹Attributeå±æ€§
- **åŒ…å«**: id, name, type, description, enumClassIdç­‰æ‰€æœ‰å­—æ®µ
- **è¦†ç›–**: åªè¦†ç›–éœ€è¦è½¬æ¢çš„å­—æ®µï¼ˆå¦‚typeè½¬æ¢ä¸ºJSONSchemaæ ¼å¼ï¼‰

## ğŸ”„ å±æ€§åˆ†ç±»é€»è¾‘

### 1. å®ä½“ç›´æ¥å±æ€§
- **æ¥æº**: `entity.attributes`
- **æ ‡è®°**: `isEntityProperty: true`
- **å¯ç¼–è¾‘**: æ˜¯

### 2. å®Œæ•´å…³è”æ¨¡å—å±æ€§
- **æ¥æº**: `entity.bundles` ä¸­çš„æ¨¡å—
- **æ ‡è®°**: `isModuleProperty: true`
- **IDæ ¼å¼**: `moduleId/attrId`
- **å¯ç¼–è¾‘**: å¦ (åªè¯»)

### 3. éƒ¨åˆ†å…³è”æ¨¡å—å±æ€§
- **æ¥æº**: å•ç‹¬æ·»åŠ çš„æ¨¡å—å±æ€§
- **æ ‡è®°**: `isModuleProperty: true`
- **å¯ç¼–è¾‘**: æ˜¯ (å¯åˆ é™¤)

### 4. ç”¨æˆ·è‡ªå®šä¹‰å±æ€§
- **æ¥æº**: ç”¨æˆ·æ‰‹åŠ¨æ·»åŠ 
- **æ ‡è®°**: æ— ç‰¹æ®Šæ ‡è®°
- **å¯ç¼–è¾‘**: æ˜¯

## ğŸ› ï¸ å®ç°è¦ç‚¹

### React Keyä½¿ç”¨
```javascript
// âœ… æ­£ç¡® - ä½¿ç”¨ç¨³å®šçš„nanoid
<PropertyEdit key={nanoidKey} />

// âŒ é”™è¯¯ - ä½¿ç”¨å¯å˜çš„è¯­ä¹‰åŒ–ID
<PropertyEdit key={property.title} />
```

### å±æ€§ç¼–è¾‘é€»è¾‘
```javascript
// ç¼–è¾‘å±æ€§åæ—¶ï¼Œåªä¿®æ”¹nameï¼Œä¸åŠ¨nanoid key
const handleEditProperty = (nanoidKey, updatedFields) => {
  // nanoidKey æ˜¯ propertiesçš„key (nanoid)
  // updatedFields.name æ˜¯æ–°çš„æ˜¾ç¤ºåç§°
  // nanoid key æ°¸è¿œä¸å˜ï¼Œç¡®ä¿Reactç»„ä»¶ç¨³å®š
}
```

### æ•°æ®æŒä¹…åŒ–
- nanoidå­˜å‚¨åœ¨ propertiesçš„keyå’Œ`_id` å­—æ®µä¸­
- é‡æ–°åŠ è½½æ—¶ä» `_id` æ¢å¤ï¼Œç¡®ä¿React keyç¨³å®š
- å¦‚æœæ²¡æœ‰ `_id`ï¼Œç”Ÿæˆæ–°çš„nanoid

## ğŸ“‹ è¡¨æ ¼ç»„ä»¶è®¾è®¡æ¨¡å¼

### åŒè¡¨æ ¼è®¾è®¡
- **èŠ‚ç‚¹è¡¨æ ¼**ï¼šåªè¯»æ˜¾ç¤ºï¼Œç®€å•æ–‡æœ¬æ¸²æŸ“
- **æŠ½å±‰è¡¨æ ¼**ï¼šå¯ç¼–è¾‘ï¼ŒInputç»„ä»¶æ¸²æŸ“
- **å…±äº«æ•°æ®æº**ï¼šä½¿ç”¨ç›¸åŒçš„æ•°æ®ç»“æ„ï¼Œä¸åŒçš„å±•ç¤ºé€»è¾‘

### Semi Design Tableæœ€ä½³å®è·µ
```javascript
// âœ… æ­£ç¡®çš„æ•°æ®ç»“æ„è®¾è®¡
{
  title: '',
  dataIndex: 'id',          // å¯¹åº”æ•°æ®å­—æ®µ
  key: 'id',               // å”¯ä¸€æ ‡è¯†
  render: (text, record) => {
    // text æ˜¯ dataSource[i][dataIndex] çš„å€¼
    // ä¼˜å…ˆä½¿ç”¨ textï¼Œå®ƒæ˜¯Semi Designè‡ªåŠ¨ä¼ é€’çš„æ­£ç¡®å€¼
    return <Input value={text} />
  }
}

// âŒ é”™è¯¯çš„åšæ³•
render: (text, record) => {
  // å¿½ç•¥textï¼Œåªä¾èµ–recordå¯èƒ½å¯¼è‡´æ˜¾ç¤ºé—®é¢˜
  return <Input value={record.someField} />
}
```

### å¯å±•å¼€è¡¨æ ¼çš„ç¼©è¿›é—®é¢˜
```javascript
// é—®é¢˜ï¼šå¯å±•å¼€è¡¨æ ¼ç¬¬ä¸€åˆ—ä¼šè‡ªåŠ¨æ·»åŠ ç¼©è¿›ï¼Œå¯¼è‡´å†…å®¹æ˜¾ç¤ºå¼‚å¸¸
// è§£å†³æ–¹æ¡ˆ1ï¼šä¸“é—¨çš„å±•å¼€åˆ—
columns = [
  {
    title: '',
    dataIndex: 'expand',
    key: 'expand',
    width: 30,
    render: () => null, // å±•å¼€æŒ‰é’®ç”±Tableè‡ªåŠ¨å¤„ç†
  },
  // å…¶ä»–å†…å®¹åˆ—ä¸å—ç¼©è¿›å½±å“
]

// è§£å†³æ–¹æ¡ˆ2ï¼šç¦ç”¨ç¼©è¿›
<Table indentSize={0} />
```

### æ¨¡å—å±æ€§çš„å‰ç¼€å¤„ç†
```javascript
// æ˜¾ç¤ºæ—¶å»æ‰æ¨¡å—å‰ç¼€
const displayValue = record.displayId || text; // container/content -> content

// ç¼–è¾‘æ—¶é‡æ–°ç»„è£…å®Œæ•´ID
onChange={(value) => {
  if (record.category === 'module' && record.moduleId) {
    const fullId = `${record.moduleId}/${value}`; // content -> container/content
    onPropertyChange(record.key, 'id', fullId);
  }
}}
```

## ğŸš« é¿å…çš„åæ¨¡å¼

1. **ä¸è¦ç”¨å±æ€§å†…å®¹ä½œä¸ºReact key**
   ```javascript
   // âŒ é”™è¯¯
   key={`entity_${attr.id}`}
   key={`custom_${propertyName}`}
   ```

2. **ä¸è¦åœ¨ç¼–è¾‘æ—¶é‡æ–°ç”Ÿæˆnanoid**
   ```javascript
   // âŒ é”™è¯¯ - æ¯æ¬¡ç¼–è¾‘éƒ½ç”Ÿæˆæ–°nanoid
   _id: nanoid()
   ```

3. **ä¸è¦éšè—metaå±æ€§**
   ```javascript
   // âŒ é”™è¯¯ - åªä¿ç•™éƒ¨åˆ†å±æ€§
   { type, description }

   // âœ… æ­£ç¡® - ä¿ç•™æ‰€æœ‰åŸå§‹å±æ€§
   { ...attr, type: convertedType }
   ```

4. **ä¸è¦å¿½ç•¥Semi Design Tableçš„textå‚æ•°**
   ```javascript
   // âŒ é”™è¯¯ - å¿½ç•¥textå‚æ•°
   render: (text, record) => <Input value={record.name} />

   // âœ… æ­£ç¡® - ä¼˜å…ˆä½¿ç”¨text
   render: (text, record) => <Input value={text} />
   ```

## ğŸ› é—®é¢˜è¯Šæ–­æ€è·¯

### UIæ˜¾ç¤ºé—®é¢˜è¯Šæ–­é¡ºåº
1. **æ£€æŸ¥HTMLç»“æ„** - çœ‹DOMå…ƒç´ æ˜¯å¦æ­£ç¡®æ¸²æŸ“
2. **æ£€æŸ¥CSSæ ·å¼** - ç¡®è®¤æ˜¯å¦æœ‰æ ·å¼å†²çªæˆ–éšè—
3. **æ£€æŸ¥æ•°æ®æµ** - ç¡®è®¤æ•°æ®æ˜¯å¦æ­£ç¡®ä¼ é€’
4. **æ£€æŸ¥ç»„ä»¶é€»è¾‘** - æœ€åæ‰æ·±å…¥ä»£ç é€»è¾‘

### å¸¸è§é—®é¢˜æ¨¡å¼
- **å†…å®¹ä¸æ˜¾ç¤º**ï¼šé€šå¸¸æ˜¯DOMç»“æ„é—®é¢˜ï¼Œä¸æ˜¯æ•°æ®é—®é¢˜
- **Inputå¤±å»ç„¦ç‚¹**ï¼šReact keyä¸ç¨³å®šå¯¼è‡´é‡æ–°æ¸²æŸ“
- **è¡¨æ ¼åˆ—é”™ä½**ï¼šå¯å±•å¼€è¡¨æ ¼çš„ç¼©è¿›å¹²æ‰°
- **æ•°æ®ä¸æ›´æ–°**ï¼šå¼•ç”¨å‹æ•°æ®æ²¡æœ‰æ­£ç¡®æ›´æ–°å¼•ç”¨

## ğŸ“ ç›¸å…³æ–‡ä»¶

- ä¸»ç»„ä»¶: [entity-properties-editor/index.tsx](mdc:apps/demo-free-layout-forked/src/components/ext/entity-properties-editor/index.tsx)
- å®ä½“å­˜å‚¨: [entity-store/index.tsx](mdc:apps/demo-free-layout-forked/src/components/ext/entity-store/index.tsx)
- æ¨¡å—å­˜å‚¨: [module-store.tsx](mdc:apps/demo-free-layout-forked/src/components/ext/entity-property-type-selector/module-store.tsx)
- èŠ‚ç‚¹è¡¨æ ¼: [node-property-table.tsx](mdc:apps/demo-free-layout-forked/src/components/ext/property-table/node-property-table.tsx)
- æŠ½å±‰è¡¨æ ¼: [drawer-property-table.tsx](mdc:apps/demo-free-layout-forked/src/components/ext/property-table/drawer-property-table.tsx)
- è¡¨æ ¼é€‚é…å™¨: [property-table-adapter.tsx](mdc:apps/demo-free-layout-forked/src/components/ext/property-table/property-table-adapter.tsx)

## âœ… éªŒè¯æ ‡å‡†

1. ä¿®æ”¹å±æ€§åæ—¶inputä¸å¤±å»ç„¦ç‚¹
2. å±æ€§é¡ºåºä¿æŒç¨³å®š
3. é¡µé¢åˆ·æ–°åReact keyä¿æŒä¸å˜
4. æ•°æ®ç»“æ„ç®€æ´æ¸…æ™°
5. æ€§èƒ½è‰¯å¥½ï¼Œæ— ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
6. æ‰€æœ‰metaå±æ€§éƒ½è¢«ä¿ç•™å’Œæ˜¾ç¤º
7. è¡¨æ ¼å†…å®¹æ­£ç¡®æ˜¾ç¤ºï¼Œæ— ç¼©è¿›å¹²æ‰°
8. æ¨¡å—å±æ€§å‰ç¼€å¤„ç†æ­£ç¡®
