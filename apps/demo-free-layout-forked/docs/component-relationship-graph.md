# 组件关系图功能文档

## 📊 功能概述

组件关系图是一个新添加的可视化页面，用于展示实体、模块、系统之间的关系。该功能通过 ECharts 图表库实现，提供了直观的网络图展示和左侧控制面板。

## 🚀 功能特性

### 1. 图形可视化
- 使用 ECharts 的 graph 类型实现力导向布局
- 不同类型的节点使用不同颜色和大小区分：
  - **实体节点**：蓝色，中等大小 (50px)
  - **模块节点**：绿色，较小 (40px)
  - **系统节点**：黄色，较大 (60px)

### 2. 左侧控制面板
- **搜索功能**：支持节点和关系的搜索过滤
- **树形结构**：按类型组织显示所有节点和关系
- **统计信息**：显示节点和关系的总数量
- **展开/折叠**：支持树节点的展开和折叠操作

### 3. 交互功能
- **缩放和平移**：支持鼠标滚轮缩放和拖拽平移
- **节点焦点**：点击节点时高亮显示相关连接
- **悬停提示**：显示节点详细信息（类型、属性数量等）

## 📁 文件结构

```
src/components/component-relationship-graph/
├── index.tsx                    # 主组件
└── echarts-placeholder.tsx      # ECharts 占位符组件
```

## 🛠️ 技术实现

### 路由配置
- 路由类型：`component-graph`
- 访问路径：`/component-graph`
- 导航位置：主导航栏 "组件关系图"

### 数据源
- **实体数据**：来自 `useEntityList()` store
- **模块数据**：来自 `useModuleStore()` store
- **系统数据**：示例数据（推演系统、决策系统、监控系统）

### 关系映射
- **实体 → 模块**：通过实体的 `bundles` 字段建立连接
- **系统 → 模块**：示例连接，展示系统与模块的依赖关系

## 📋 使用方法

### 1. 访问页面
在主导航栏点击 "组件关系图" 选项卡

### 2. 查看图表
- 图表会自动加载当前系统中的实体和模块数据
- 使用鼠标拖拽可以平移视图
- 使用鼠标滚轮可以缩放视图
- 点击节点可以高亮显示相关连接

### 3. 使用控制面板
- **搜索**：在搜索框中输入关键词过滤显示
- **浏览结构**：通过左侧树形结构查看所有节点和关系
- **查看统计**：底部显示当前节点和关系的数量

## ⚠️ 当前限制

### 1. ECharts 依赖
- 目前使用占位符组件显示
- 需要安装 `echarts` 和 `echarts-for-react` 依赖
- 安装完成后需要替换占位符为真实的 ECharts 组件

### 2. 数据限制
- 系统节点为示例数据
- 实体和模块关系基于现有数据结构
- 未来可扩展支持更多关系类型

### 3. 交互功能
- 目前为只读显示，不支持编辑
- 高亮和隐藏功能的 UI 已准备，但逻辑需要完善

## 🔮 未来扩展

### 1. 完整的 ECharts 集成
```typescript
// 替换占位符组件
import ReactECharts from 'echarts-for-react';

<ReactECharts
  option={echartsOption}
  style={{ height: '100%', width: '100%' }}
  opts={{ renderer: 'canvas' }}
/>
```

### 2. 高级交互功能
- 节点和边的显示/隐藏控制
- 节点高亮标记
- 关系类型过滤
- 节点分组和聚合

### 3. 数据扩展
- 支持更多实体类型
- 动态系统数据
- 实时数据更新
- 历史版本对比

### 4. 布局选项
- 多种布局算法选择
- 自定义布局参数
- 保存和恢复视图状态

## 📊 数据结构

### GraphNode 接口
```typescript
interface GraphNode {
  id: string;           // 节点唯一标识
  name: string;         // 显示名称
  category: string;     // 节点类型（实体/模块/系统）
  symbolSize: number;   // 节点大小
  value: number;        // 节点值（如属性数量）
  visible: boolean;     // 是否可见
  highlighted: boolean; // 是否高亮
}
```

### GraphEdge 接口
```typescript
interface GraphEdge {
  source: string;       // 源节点ID
  target: string;       // 目标节点ID
  visible: boolean;     // 是否可见
  highlighted: boolean; // 是否高亮
}
```

## 🏗️ 实现细节

### 1. 组件架构
- 使用 React Hooks 管理状态
- 响应式数据更新
- 模块化组件设计

### 2. 性能优化
- 使用 `useMemo` 缓存计算结果
- 避免不必要的重新渲染
- 数据结构优化

### 3. 类型安全
- 完整的 TypeScript 类型定义
- 接口约束确保数据一致性
- 编译时错误检查

这个功能为系统提供了强大的可视化能力，帮助用户理解组件之间的复杂关系，是系统架构分析和调试的重要工具。
