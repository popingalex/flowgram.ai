# å½“å‰ç»„ä»¶çŠ¶æ€åˆ†æ

## ğŸ“Š ç»„ä»¶æ¸…å•å’Œé—®é¢˜åˆ†æ

### ğŸ”§ @ext æ‰©å±•ç»„ä»¶

#### 1. enhanced-dynamic-value-input
**æ–‡ä»¶**: `src/components/ext/enhanced-dynamic-value-input/`
**çŠ¶æ€**: âœ… å·²å®Œæˆï¼ŒåŠŸèƒ½è‰¯å¥½
**åŠŸèƒ½**: å¢å¼ºçš„åŠ¨æ€å€¼è¾“å…¥ç»„ä»¶ï¼Œæ”¯æŒå¸¸é‡å’Œå˜é‡å¼•ç”¨
**é—®é¢˜**: æ— é‡å¤§é—®é¢˜
**ä½¿ç”¨æƒ…å†µ**: å·²é›†æˆåˆ° properties-edit ä¸­

#### 2. enhanced-variable-selector
**æ–‡ä»¶**: `src/components/ext/enhanced-variable-selector/`
**çŠ¶æ€**: âœ… å·²å®Œæˆï¼ŒåŠŸèƒ½è‰¯å¥½
**åŠŸèƒ½**: å¢å¼ºçš„å˜é‡é€‰æ‹©å™¨ï¼Œæ”¯æŒæ¨¡å—åˆ†ç»„å’Œ$contextèŠ‚ç‚¹å¤„ç†
**é—®é¢˜**: æ— é‡å¤§é—®é¢˜
**ä½¿ç”¨æƒ…å†µ**: è¢« enhanced-dynamic-value-input ä½¿ç”¨

#### 3. enhanced-condition-row
**æ–‡ä»¶**: `src/components/ext/enhanced-condition-row/`
**çŠ¶æ€**: âœ… å·²å®Œæˆï¼ŒåŠŸèƒ½è‰¯å¥½
**åŠŸèƒ½**: å¢å¼ºçš„æ¡ä»¶è¡Œç»„ä»¶
**é—®é¢˜**: æ— é‡å¤§é—®é¢˜
**ä½¿ç”¨æƒ…å†µ**: æ¡ä»¶èŠ‚ç‚¹ä¸­ä½¿ç”¨

#### 4. entity-property-tables
**æ–‡ä»¶**: `src/components/ext/entity-property-tables/`
**çŠ¶æ€**: âš ï¸ åŠŸèƒ½åˆ†æ•£ï¼Œéœ€è¦æ•´åˆ
**åŠŸèƒ½**: å®ä½“å±æ€§è¡¨æ ¼ç›¸å…³ç»„ä»¶
**ç»„ä»¶æ¸…å•**:
- `sidebar-editor.tsx` - ä¾§è¾¹æ å¯ç¼–è¾‘è¡¨æ ¼ âœ…
- `unified-display.tsx` - ç»Ÿä¸€æ˜¾ç¤ºç»„ä»¶ âš ï¸ åŠŸèƒ½æœ‰é™
**é—®é¢˜**:
- unified-display åŠŸèƒ½ä¸å¤Ÿå®Œæ•´ï¼Œåªæ”¯æŒåŸºç¡€æ˜¾ç¤º
- sidebar-editor åŠŸèƒ½å®Œæ•´ä½†åªç”¨äºä¾§è¾¹æ 
- ç¼ºå°‘ç»Ÿä¸€çš„æ•°æ®ç®¡ç†é€»è¾‘

#### 5. entity-property-type-selector
**æ–‡ä»¶**: `src/components/ext/entity-property-type-selector/`
**çŠ¶æ€**: âœ… å·²å®Œæˆï¼ŒåŠŸèƒ½è‰¯å¥½
**åŠŸèƒ½**: å±æ€§ç±»å‹é€‰æ‹©å™¨ï¼Œæ”¯æŒæ•°æ®é™åˆ¶
**é—®é¢˜**: æ— é‡å¤§é—®é¢˜

#### 6. module-property-tables
**æ–‡ä»¶**: `src/components/ext/module-property-tables/`
**çŠ¶æ€**: âœ… å·²å®Œæˆï¼ŒåŠŸèƒ½è‰¯å¥½
**åŠŸèƒ½**: æ¨¡å—å±æ€§è¡¨æ ¼ç»„ä»¶
**é—®é¢˜**: ä¸ entity-property-tables å­˜åœ¨é‡å¤é€»è¾‘

#### 7. å…¶ä»–ç»„ä»¶
- `entity-behavior-workflow-generator` âœ… åŠŸèƒ½å®Œæ•´
- `enum-class-selector` âœ… åŠŸèƒ½å®Œæ•´
- `invoke-function-selector` âœ… åŠŸèƒ½å®Œæ•´
- `module-selector` âœ… åŠŸèƒ½å®Œæ•´

### ğŸ“ @form-components è¡¨å•ç»„ä»¶

#### 1. form-outputs
**æ–‡ä»¶**: `src/form-components/form-outputs/index.tsx`
**çŠ¶æ€**: âŒ é€»è¾‘å¤æ‚ï¼Œéœ€è¦é‡æ„
**åŠŸèƒ½**: å¤„ç†è¡¨å•è¾“å‡ºæ˜¾ç¤ºï¼Œæ”¯æŒèŠ‚ç‚¹å’Œä¾§è¾¹æ æ¨¡å¼
**é—®é¢˜**:
- æ‰¿æ‹…è¿‡å¤šèŒè´£ï¼šæ¨¡å¼åˆ¤æ–­ã€æ•°æ®è½¬æ¢ã€ç»„ä»¶é€‰æ‹©
- æ•°æ®è½¬æ¢é€»è¾‘å¤æ‚ä¸”é‡å¤
- ä¾§è¾¹æ å’ŒèŠ‚ç‚¹æ¨¡å¼ä½¿ç”¨ä¸åŒç»„ä»¶
- è¿‡æ»¤é€»è¾‘åˆ†æ•£ä¸”éš¾ä»¥ç»´æŠ¤

```typescript
// å½“å‰é—®é¢˜ä»£ç ç¤ºä¾‹
const processedProperties = Object.entries(properties)
  .filter(([key, property]) => {
    const prop = property as any;

    // å¤æ‚çš„è¿‡æ»¤é€»è¾‘ï¼Œéš¾ä»¥ç»´æŠ¤
    if (isStartNode) {
      return prop.isEntityProperty && !prop.isModuleProperty;
    }

    if (node?.type === 'action' || node?.type === 'invoke' || node?.type === 'end') {
      return !prop.isEntityProperty && !prop.isModuleProperty;
    }

    return !prop.isEntityProperty && !prop.isModuleProperty;
  })
  .map(([key, property]) => {
    // é‡å¤çš„æ•°æ®è½¬æ¢é€»è¾‘
    const prop = property as any;
    return {
      key: prop._indexId || key,
      id: prop.id || key,
      name: prop.name || prop.title || prop.id || key,
      type: prop.type || 'string',
      description: prop.description,
      required: prop.isPropertyRequired,
    };
  });
```

#### 2. form-entity-properties
**æ–‡ä»¶**: `src/form-components/form-entity-properties/index.tsx`
**çŠ¶æ€**: âš ï¸ åŠŸèƒ½ç®€å•ï¼Œä¸å…¶ä»–ç»„ä»¶é‡å¤
**åŠŸèƒ½**: æ˜¾ç¤ºå®ä½“å±æ€§
**é—®é¢˜**: ä¸ entity-property-tables åŠŸèƒ½é‡å¤

#### 3. form-module-outputs
**æ–‡ä»¶**: `src/form-components/form-module-outputs/index.tsx`
**çŠ¶æ€**: âœ… åŠŸèƒ½å®Œæ•´ï¼Œä½†å¯ä»¥ä¼˜åŒ–
**åŠŸèƒ½**: æ˜¾ç¤ºæ¨¡å—è¾“å‡º
**é—®é¢˜**: ä¸å±æ€§è¡¨æ ¼ç»„ä»¶å­˜åœ¨é‡å¤é€»è¾‘

#### 4. properties-edit
**æ–‡ä»¶**: `src/form-components/properties-edit/`
**çŠ¶æ€**: âœ… å·²æ›´æ–°ä½¿ç”¨å¢å¼ºç»„ä»¶
**åŠŸèƒ½**: å±æ€§ç¼–è¾‘ç»„ä»¶
**é—®é¢˜**: æ— é‡å¤§é—®é¢˜

#### 5. å…¶ä»–è¡¨å•ç»„ä»¶
- `form-entity-metas` âœ… åŠŸèƒ½å®Œæ•´
- `form-header` âœ… åŠŸèƒ½å®Œæ•´
- `form-inputs` âœ… åŠŸèƒ½å®Œæ•´
- `form-content` âœ… åŠŸèƒ½å®Œæ•´

### ğŸ—„ï¸ @stores çŠ¶æ€ç®¡ç†

#### 1. current-entity.store
**æ–‡ä»¶**: `src/stores/current-entity.store.ts`
**çŠ¶æ€**: âœ… åŠŸèƒ½å®Œæ•´ï¼Œè®¾è®¡è‰¯å¥½
**åŠŸèƒ½**: ç®¡ç†å½“å‰ç¼–è¾‘å®ä½“çš„çŠ¶æ€
**é—®é¢˜**: ä¸è¡¨å•ç»„ä»¶çš„æ•°æ®åŒæ­¥éœ€è¦ä¼˜åŒ–

#### 2. entity-list.store
**æ–‡ä»¶**: `src/stores/entity-list.ts`
**çŠ¶æ€**: âœ… åŠŸèƒ½å®Œæ•´
**åŠŸèƒ½**: ç®¡ç†å®ä½“åˆ—è¡¨
**é—®é¢˜**: æ— é‡å¤§é—®é¢˜

#### 3. module.store
**æ–‡ä»¶**: `src/stores/module.store.tsx`
**çŠ¶æ€**: âœ… åŠŸèƒ½å®Œæ•´ï¼Œè®¾è®¡è‰¯å¥½
**åŠŸèƒ½**: ç®¡ç†æ¨¡å—çŠ¶æ€å’Œç¼–è¾‘
**é—®é¢˜**: æ— é‡å¤§é—®é¢˜

#### 4. å…¶ä»– stores
- `behavior.store` âœ… åŠŸèƒ½å®Œæ•´
- `graph.store` âœ… åŠŸèƒ½å®Œæ•´
- `current-graph.store` âœ… åŠŸèƒ½å®Œæ•´

## ğŸ” é‡å¤é€»è¾‘åˆ†æ

### 1. æ•°æ®è½¬æ¢é€»è¾‘é‡å¤
**ä½ç½®**:
- `form-outputs/index.tsx` - PropertyData è½¬æ¢
- `entity-property-tables/unified-display.tsx` - æ•°æ®å¤„ç†
- `module-property-tables/sidebar-tree.tsx` - æ¨¡å—æ•°æ®è½¬æ¢

**é‡å¤ä»£ç ç¤ºä¾‹**:
```typescript
// åœ¨å¤šä¸ªåœ°æ–¹éƒ½æœ‰ç±»ä¼¼çš„è½¬æ¢é€»è¾‘
return {
  key: prop._indexId || key,
  id: prop.id || key,
  name: prop.name || prop.title || prop.id || key,
  type: prop.type || 'string',
  description: prop.description,
  required: prop.isPropertyRequired,
};
```

### 2. å±æ€§è¿‡æ»¤é€»è¾‘é‡å¤
**ä½ç½®**:
- `form-outputs/index.tsx` - èŠ‚ç‚¹ç±»å‹è¿‡æ»¤
- `utils/property-filters.ts` - é€šç”¨è¿‡æ»¤ï¼ˆå·²å­˜åœ¨ï¼‰
- å„ä¸ªå±æ€§è¡¨æ ¼ç»„ä»¶ä¸­çš„è¿‡æ»¤é€»è¾‘

### 3. è¡¨æ ¼æ˜¾ç¤ºé€»è¾‘é‡å¤
**ä½ç½®**:
- `entity-property-tables/unified-display.tsx`
- `entity-property-tables/sidebar-editor.tsx`
- `module-property-tables/sidebar-tree.tsx`

## ğŸ“‹ æ•°æ®æµé—®é¢˜

### 1. æ•°æ®æ¥æºä¸ä¸€è‡´
```
form-outputs (Field data) â†â†’ current-entity.store (Entity data)
                â†“
        æ•°æ®åŒæ­¥é—®é¢˜
```

### 2. ç»„ä»¶èŒè´£æ··ä¹±
```
FormOutputs ç»„ä»¶æ‰¿æ‹…çš„èŒè´£ï¼š
â”œâ”€â”€ æ¨¡å¼åˆ¤æ–­ (isSidebar)
â”œâ”€â”€ èŠ‚ç‚¹ç±»å‹åˆ¤æ–­ (isStartNode)
â”œâ”€â”€ æ•°æ®æºé€‰æ‹© (Field vs Store)
â”œâ”€â”€ æ•°æ®è½¬æ¢ (Schema â†’ PropertyData)
â”œâ”€â”€ æ•°æ®è¿‡æ»¤ (æŒ‰èŠ‚ç‚¹ç±»å‹è¿‡æ»¤)
â”œâ”€â”€ ç»„ä»¶é€‰æ‹© (UnifiedDisplay vs EditableTable)
â””â”€â”€ æ¸²æŸ“æ§åˆ¶ (key ç”Ÿæˆ)
```

## ğŸ¯ é‡æ„ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ (ç«‹å³å¤„ç†)
1. **form-outputs é‡æ„** - é€»è¾‘è¿‡äºå¤æ‚
2. **ç»Ÿä¸€æ•°æ®è½¬æ¢** - æ¶ˆé™¤é‡å¤ä»£ç 
3. **ç»Ÿä¸€å±æ€§è¡¨æ ¼** - æ•´åˆ unified-display å’Œ sidebar-editor

### ä¸­ä¼˜å…ˆçº§ (åç»­å¤„ç†)
1. **ä¼˜åŒ–æ•°æ®åŒæ­¥** - store å’Œ Field æ•°æ®ä¸€è‡´æ€§
2. **æ€§èƒ½ä¼˜åŒ–** - å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
3. **ç»„ä»¶APIç»Ÿä¸€** - æ ‡å‡†åŒ–ç»„ä»¶æ¥å£

### ä½ä¼˜å…ˆçº§ (å¯é€‰)
1. **æ·»åŠ è™šæ‹Ÿæ»šåŠ¨** - å¤§æ•°æ®é‡ä¼˜åŒ–
2. **å¢å¼ºæµ‹è¯•è¦†ç›–** - æé«˜ä»£ç è´¨é‡
3. **æ–‡æ¡£å®Œå–„** - ä½¿ç”¨æŒ‡å—å’Œæœ€ä½³å®è·µ

## ğŸ’¡ é‡æ„å»ºè®®

### 1. ç«‹å³å¯ä»¥å¼€å§‹çš„æ”¹è¿›
- æå– PropertyDataManager å·¥å…·ç±»
- ç»Ÿä¸€ PropertyData æ¥å£
- é‡æ„ form-outputs ä½¿ç”¨æ–°çš„æ•°æ®ç®¡ç†

### 2. éœ€è¦è®¨è®ºçš„è®¾è®¡å†³ç­–
- æ˜¯å¦ä¿æŒ unified-display å’Œ sidebar-editor åˆ†ç¦»ï¼Ÿ
- å¦‚ä½•å¤„ç† Field æ•°æ®å’Œ Store æ•°æ®çš„åŒæ­¥ï¼Ÿ
- æ–°ç»„ä»¶çš„ API è®¾è®¡æ˜¯å¦åˆç†ï¼Ÿ

### 3. é£é™©æ§åˆ¶æªæ–½
- ä¿æŒç°æœ‰ API å…¼å®¹æ€§
- åˆ†é˜¶æ®µè¿ç§»ï¼Œé¿å…å¤§è§„æ¨¡ç ´åæ€§å˜æ›´
- å……åˆ†çš„æµ‹è¯•è¦†ç›–

## ğŸ“Š ä»£ç ç»Ÿè®¡

### å½“å‰ä»£ç é‡
- @ext ç»„ä»¶: ~3000 è¡Œ
- @form-components: ~1500 è¡Œ
- @stores: ~2000 è¡Œ
- æ€»è®¡: ~6500 è¡Œ

### é¢„æœŸé‡æ„å
- å‡å°‘é‡å¤ä»£ç : ~30%
- æ–°å¢å·¥å…·ç±»: ~500 è¡Œ
- å‡€å‡å°‘ä»£ç : ~1500 è¡Œ

---

**ç»“è®º**: å½“å‰ç»„ä»¶åŠŸèƒ½åŸºæœ¬å®Œæ•´ï¼Œä½†å­˜åœ¨æ˜æ˜¾çš„é‡å¤é€»è¾‘å’ŒèŒè´£æ··ä¹±é—®é¢˜ã€‚å»ºè®®æŒ‰ç…§é‡æ„è®¡åˆ’åˆ†é˜¶æ®µè¿›è¡Œä¼˜åŒ–ï¼Œé‡ç‚¹è§£å†³ form-outputs çš„å¤æ‚æ€§å’Œæ•°æ®è½¬æ¢çš„é‡å¤é—®é¢˜ã€‚
