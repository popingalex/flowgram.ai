<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å˜é‡è·¯å¾„è°ƒè¯•å·¥å…·</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .input-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
      }
      input[type="text"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background-color: #0056b3;
      }
      .result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 4px;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 12px;
      }
      .result.success {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .result.error {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .result.info {
        background-color: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
      }
      .debug-section {
        margin-top: 20px;
      }
      .path-list {
        max-height: 300px;
        overflow-y: auto;
        background: #f8f9fa;
        padding: 10px;
        border: 1px solid #dee2e6;
        border-radius: 4px;
      }
      .path-item {
        padding: 4px 0;
        border-bottom: 1px solid #eee;
      }
      .path-item:last-child {
        border-bottom: none;
      }
      .module-path {
        color: #007bff;
        font-weight: bold;
      }
      .entity-path {
        color: #28a745;
      }
      .context-path {
        color: #ffc107;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>å˜é‡è·¯å¾„è°ƒè¯•å·¥å…·</h1>
      <p>
        æ­¤å·¥å…·ç”¨äºæµ‹è¯•å˜é‡é€‰æ‹©å™¨ä¸­çš„è·¯å¾„åŒ¹é…é€»è¾‘ï¼Œå¸®åŠ©è°ƒè¯•"æ— æ³•æ‰¾åˆ°é€‰ä¸­é¡¹"çš„é—®é¢˜ã€‚
      </p>

      <div class="input-group">
        <label for="expectedPath"
          >æœŸæœ›çš„å˜é‡è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š$start.controlled/commandsï¼‰:</label
        >
        <input
          type="text"
          id="expectedPath"
          placeholder="è¾“å…¥æœŸæœ›çš„å˜é‡è·¯å¾„..."
          value="$start.controlled/commands"
        />
      </div>

      <div class="input-group">
        <label for="availablePaths">å¯ç”¨çš„å˜é‡è·¯å¾„åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰:</label>
        <textarea
          id="availablePaths"
          rows="10"
          style="
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
          "
          placeholder="è¾“å…¥æ‰€æœ‰å¯ç”¨çš„å˜é‡è·¯å¾„..."
        >
$start.vehicle_yard_id
$start.task_id
$start.vehicle_name
$start.controlled/commands
$start.controlled/action
$start.controlled/stance
$start.vehicle/type
$start.mobile/velocity
$start.transform/position
$start.$context.currentTime
$start.$context.currentBranch</textarea
        >
      </div>

      <button onclick="analyzeVariablePaths()">åˆ†æè·¯å¾„åŒ¹é…</button>

      <div id="result" class="result" style="display: none"></div>

      <div class="debug-section">
        <h3>å¸¸è§é—®é¢˜æ¨¡å¼</h3>
        <div class="container" style="background: #f8f9fa">
          <h4>1. æ¨¡å—å±æ€§è·¯å¾„æ ¼å¼</h4>
          <p>
            <strong>é”™è¯¯æ ¼å¼:</strong>
            <code>$start.module_group_controlled.commands</code>
          </p>
          <p>
            <strong>æ­£ç¡®æ ¼å¼:</strong> <code>$start.controlled/commands</code>
          </p>

          <h4>2. åˆ†ç»„èŠ‚ç‚¹ä¸å¶å­èŠ‚ç‚¹</h4>
          <p>
            <strong>åˆ†ç»„èŠ‚ç‚¹:</strong>
            <code>$start.module_group_controlled</code> (ä¸å¯é€‰ä¸­)
          </p>
          <p>
            <strong>å¶å­èŠ‚ç‚¹:</strong>
            <code>$start.controlled/commands</code> (å¯é€‰ä¸­)
          </p>

          <h4>3. keyPath vs value æ ¼å¼</h4>
          <p>
            <strong>keyPath:</strong>
            <code>['$start', 'controlled/commands']</code>
          </p>
          <p><strong>value:</strong> <code>$start.controlled/commands</code></p>
        </div>
      </div>
    </div>

    <script>
      function analyzeVariablePaths() {
        const expectedPath = document
          .getElementById("expectedPath")
          .value.trim();
        const availablePathsText = document
          .getElementById("availablePaths")
          .value.trim();
        const availablePaths = availablePathsText
          .split("\n")
          .map((p) => p.trim())
          .filter((p) => p);

        const resultDiv = document.getElementById("result");
        resultDiv.style.display = "block";

        if (!expectedPath) {
          resultDiv.className = "result error";
          resultDiv.textContent = "è¯·è¾“å…¥æœŸæœ›çš„å˜é‡è·¯å¾„";
          return;
        }

        if (availablePaths.length === 0) {
          resultDiv.className = "result error";
          resultDiv.textContent = "è¯·è¾“å…¥å¯ç”¨çš„å˜é‡è·¯å¾„åˆ—è¡¨";
          return;
        }

        // åˆ†æè·¯å¾„åŒ¹é…
        const analysis = {
          expectedPath: expectedPath,
          availablePathsCount: availablePaths.length,
          exactMatch: null,
          partialMatches: [],
          moduleRelatedPaths: [],
          entityPaths: [],
          contextPaths: [],
          suggestions: [],
        };

        // æ£€æŸ¥ç²¾ç¡®åŒ¹é…
        if (availablePaths.includes(expectedPath)) {
          analysis.exactMatch = expectedPath;
        }

        // åˆ†ç±»è·¯å¾„
        availablePaths.forEach((path) => {
          if (path.includes("/")) {
            analysis.moduleRelatedPaths.push(path);
          } else if (path.includes("$context")) {
            analysis.contextPaths.push(path);
          } else {
            analysis.entityPaths.push(path);
          }

          // æ£€æŸ¥éƒ¨åˆ†åŒ¹é…
          const expectedParts = expectedPath.split(".");
          const pathParts = path.split(".");

          let matchScore = 0;
          expectedParts.forEach((part, index) => {
            if (pathParts[index] === part) {
              matchScore++;
            }
          });

          if (matchScore > 0 && matchScore < expectedParts.length) {
            analysis.partialMatches.push({
              path: path,
              score: matchScore,
              maxScore: expectedParts.length,
            });
          }
        });

        // ç”Ÿæˆå»ºè®®
        if (!analysis.exactMatch) {
          if (analysis.partialMatches.length > 0) {
            analysis.partialMatches.sort((a, b) => b.score - a.score);
            analysis.suggestions.push(
              `æœ€ç›¸ä¼¼çš„è·¯å¾„: ${analysis.partialMatches[0].path}`
            );
          }

          const expectedLastPart = expectedPath.split(".").pop();
          const similarByLastPart = availablePaths.filter(
            (path) => path.split(".").pop() === expectedLastPart
          );

          if (similarByLastPart.length > 0) {
            analysis.suggestions.push(
              `ç›¸åŒæœ«å°¾éƒ¨åˆ†çš„è·¯å¾„: ${similarByLastPart.join(", ")}`
            );
          }

          // æ£€æŸ¥æ˜¯å¦æ˜¯æ¨¡å—å±æ€§æ ¼å¼é—®é¢˜
          if (expectedPath.includes("/")) {
            const moduleAttrPattern = expectedPath.split("/");
            if (moduleAttrPattern.length === 2) {
              const [modulePart, attrPart] = moduleAttrPattern;
              const alternativeFormats = [
                `${modulePart}.${attrPart}`,
                `${modulePart}_${attrPart}`,
                `${modulePart}-${attrPart}`,
              ];

              alternativeFormats.forEach((alt) => {
                if (availablePaths.some((p) => p.includes(alt))) {
                  analysis.suggestions.push(`å¯èƒ½çš„æ›¿ä»£æ ¼å¼: ${alt}`);
                }
              });
            }
          }
        }

        // æ˜¾ç¤ºç»“æœ
        let resultText = "";

        if (analysis.exactMatch) {
          resultDiv.className = "result success";
          resultText = `âœ… æ‰¾åˆ°ç²¾ç¡®åŒ¹é…: ${analysis.exactMatch}\n\n`;
        } else {
          resultDiv.className = "result error";
          resultText = `âŒ æœªæ‰¾åˆ°ç²¾ç¡®åŒ¹é…: ${expectedPath}\n\n`;
        }

        resultText += `ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:\n`;
        resultText += `- æ€»è·¯å¾„æ•°é‡: ${analysis.availablePathsCount}\n`;
        resultText += `- æ¨¡å—å±æ€§è·¯å¾„: ${analysis.moduleRelatedPaths.length}\n`;
        resultText += `- å®ä½“å±æ€§è·¯å¾„: ${analysis.entityPaths.length}\n`;
        resultText += `- ä¸Šä¸‹æ–‡è·¯å¾„: ${analysis.contextPaths.length}\n`;
        resultText += `- éƒ¨åˆ†åŒ¹é…: ${analysis.partialMatches.length}\n\n`;

        if (analysis.moduleRelatedPaths.length > 0) {
          resultText += `ğŸ”§ æ¨¡å—å±æ€§è·¯å¾„:\n`;
          analysis.moduleRelatedPaths.forEach((path) => {
            resultText += `  - ${path}\n`;
          });
          resultText += "\n";
        }

        if (analysis.partialMatches.length > 0) {
          resultText += `ğŸ” éƒ¨åˆ†åŒ¹é…çš„è·¯å¾„:\n`;
          analysis.partialMatches.forEach((match) => {
            resultText += `  - ${match.path} (åŒ¹é…åº¦: ${match.score}/${match.maxScore})\n`;
          });
          resultText += "\n";
        }

        if (analysis.suggestions.length > 0) {
          resultText += `ğŸ’¡ å»ºè®®:\n`;
          analysis.suggestions.forEach((suggestion) => {
            resultText += `  - ${suggestion}\n`;
          });
          resultText += "\n";
        }

        if (!analysis.exactMatch && analysis.suggestions.length === 0) {
          resultText += `ğŸ¤” å¯èƒ½çš„é—®é¢˜:\n`;
          resultText += `  - è·¯å¾„æ ¼å¼ä¸æ­£ç¡®\n`;
          resultText += `  - å˜é‡æ•°æ®æœªæ­£ç¡®åŠ è½½\n`;
          resultText += `  - æ¨¡å—åˆ†ç»„é€»è¾‘å­˜åœ¨é—®é¢˜\n`;
          resultText += `  - keyPath ä¸ value æ ¼å¼ä¸åŒ¹é…\n`;
        }

        resultDiv.textContent = resultText;
      }

      // è‡ªåŠ¨è¿è¡Œä¸€æ¬¡åˆ†æ
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(analyzeVariablePaths, 500);
      });
    </script>
  </body>
</html>
