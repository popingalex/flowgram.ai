# Input失焦问题调试任务

## 🎯 任务目标
修复实体属性编辑表格中输入框失去焦点的问题，采用渐进式改进策略

## 📋 执行步骤

### 阶段1：问题诊断（不修改现有代码） ✅ 已完成
- [x] 分析当前数据流：确认问题出现在 `updateAttributeProperty` 中的 `cloneDeep`
- [x] 添加调试日志，观察组件重新渲染情况
- [x] 确认问题：每次更新都重建整个实体对象，导致引用变化
- [x] 用户确认Vue式分离状态管理思路

### 阶段2：非破坏性优化（保留原有功能） ✅ 进行中
- [x] 创建分离式实体编辑store (`entity-edit-separated.ts`)
- [x] 修改表格组件支持两种store模式
- [x] **修复关键问题**：启用分离式store (`useSeparatedStore={true}`)
- [ ] 测试分离式store的input焦点表现
- [ ] 对比两种方案的性能差异

### 阶段3：清理和优化（可选）
- [ ] 在确认新方案稳定后，考虑是否需要清理旧代码

## 📊 当前状态
- **状态**: 阶段2 - 非破坏性优化
- **当前步骤**: 已实现分离式store，准备测试
- **关键实现**:
  - 基础信息、属性Map、模块Set分离管理
  - 精确更新：只修改单个属性字段，其他引用保持不变
  - 向后兼容：支持新旧两种store模式
- **关键修复**: 使用Immer中间件，遵循Zustand最佳实践
- **核心改进**: `updateAttributeProperty`现在使用Immer安全地直接修改属性
- **下一步**: 测试新的Immer store是否解决input失焦问题

## 🚫 约束条件
- 不修改现有的数据结构
- 不修改现有的接口
- 每个改动都要经过测试验证
- 出现问题立即回滚
